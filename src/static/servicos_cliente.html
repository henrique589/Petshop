<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>Painel de Serviços</title>
    <style>
        .card {
            border: 1px solid #ccc;
            padding: 12px;
            margin: 12px;
            border-radius: 8px;
        }

        .input-group {
            margin-bottom: 8px;
        }

        .back-link {
            display: block;
            margin-top: 20px;
            text-align: center;
        }
    </style>
</head>

<body>
    <h2>Lista de Serviços</h2>
    <div id="lista-servicos"></div>
    <script>
        function carregarServicos() {
            fetch('/api/servicos')
                .then(res => res.json())
                .then(servicos => {
                    const div = document.getElementById('lista-servicos');
                    div.innerHTML = '';
                    servicos.forEach(s => {
                        const card = document.createElement('div');
                        card.className = 'card';
                        card.innerHTML = `
                            <strong>Nome:</strong> ${s.nome}<br>
                            <strong>Descrição:</strong> ${s.descricao}<br>
                            <strong>Preço:</strong> R$ ${s.preco.toFixed(2)}<br>
                            <strong>Estoque:</strong> ${s.estoque}<br>
                            <strong>Duração:</strong> 30 min<br>
                        `;
                        div.appendChild(card);
                    });
                });
        }

        carregarServicos();
    </script>

    <h3>Agendar Serviço</h3>
    <form id="form-agendamento">
        <select name="pet_id" id="pet_id" required></select><br>
        <select name="servico_id" id="servico_id" required></select><br>
        <input type="date" name="data" required><br>
        <input type="time" name="hora" required><br>
        <button type="submit">Agendar</button>
    </form>

    <script>
        async function carregarPets() {
            const res = await fetch('/api/pets');
            const pets = await res.json();
            const select = document.getElementById('pet_id');
            pets.forEach(p => {
                const opt = document.createElement('option');
                opt.value = p.id_pet;
                opt.textContent = p.nome + " (" + p.raca + ")";
                select.appendChild(opt);
            });
        }

        async function carregarServicosAgendamento() {
            const res = await fetch('/api/servicos');
            const servicos = await res.json();
            const select = document.getElementById('servico_id');
            servicos.forEach(s => {
                const opt = document.createElement('option');
                opt.value = s.id;
                opt.textContent = s.nome + " - R$ " + s.preco.toFixed(2);
                select.appendChild(opt);
            });
        }

        document.getElementById('form-agendamento').addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            try {
                const res = await fetch('/api/agendamentos', {
                    method: 'POST',
                    body: formData
                });
                if (res.ok) {
                    alert("✅ Agendamento realizado com sucesso!");
                    this.reset();
                } else {
                    const data = await res.json();
                    alert("❌ " + (data.erro || "Erro ao agendar"));
                }
            } catch (err) {
                alert("❌ Erro inesperado: " + err.message);
            }
        });


        carregarPets();
        carregarServicosAgendamento();
    </script>

    <a href="/perfil" class="back-link">Voltar ao Perfil</a>
</body>

</html>
