<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <title>Perfil do Cliente</title>
  <style>

    form#form-pet {
      background-color: #e4e4e4;
      padding: 20px 25px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      max-width: 500px;
      margin-top: 30px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    form#form-pet input {
      padding: 12px 14px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s, box-shadow 0.3s;
    }

    form#form-pet input:focus {
      outline: none;
      border-color: #007bff;
      box-shadow: 0 0 0 3px rgba(0,123,255,0.2);
    }

    .form-buttons {
      display: flex;
      gap: 10px;
      justify-content: flex-start;
      margin-top: 10px;
    }

    .btn {
      padding: 10px 18px;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      font-size: 15px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .btn-primary {
      background-color: #4f5255;
      color: white;
    }

    .btn-primary:hover {
      background-color: #1b8805;
    }

    .btn-secondary {
      background-color: #6c757d;
      color: white;
    }

    .btn-secondary:hover {
      background-color: #8f0e0e;
    }

    .titulo-grande::after {
      content: '';
      display: block;
      width: 200px;
      height: 4px;
      background-color: #c00;
      margin-top: 8px;
      border-radius: 2px;
    }

    .titulo-medio::after {
      content: '';
      display: block;
      width: 160px;
      height: 4px;
      background-color: #c00;
      margin-top: 8px;
      border-radius: 2px;
    }

    body {
      font-family: Arial, sans-serif;
      margin: 40px;
      background-color: #fff;
      color: #333;
      position: relative;
      min-height: 100vh;
    }

    h2 {
      font-size: 28px;
      margin-bottom: 20px;
    }

    .nav-links {
      display: none;
    }

    #lista-pets {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }

    .card {
      background-color: #fefefe;
      border: 1px solid #ccc;
      padding: 16px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
      width: 250px;
    }

    .card button {
      margin-top: 10px;
      padding: 8px 12px;
      border: none;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
    }

    .card button:first-of-type {
      background-color: #ccc;
    }

    .card button:last-of-type {
      background-color: #c00;
      color: white;
    }

    hr {
      margin: 40px 0 20px;
    }

    form {
      max-width: 400px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    form input {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    form button {
      padding: 10px;
      background-color: #333;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }

    form button[type="button"] {
      background-color: #999;
    }

    .btn-fixed {
      position: fixed;
      bottom: 20px;
      padding: 12px 20px;
      background-color: #333;
      color: white;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      z-index: 100;
    }

    .btn-servicos {
      left: 20px;
    }

    .btn-sair {
      right: 20px;
    }
  </style>
</head>

<body>
  <h2 class="titulo-medio">Seus Pets</h2>
  <div id="lista-pets"></div>

  <hr>
  <h3 id="form-title" class=" titulo-grande">Cadastrar Novo Pet</h3>
  <form id="form-pet">
    <input type="hidden" name="id_pet" id="id_pet">
    <input type="text" name="nome" placeholder="Nome do Pet" required>
    <input type="text" name="raca" placeholder="Raça" required>
    <input type="number" name="idade" placeholder="Idade" required>
    <input type="number" step="0.1" name="peso" placeholder="Peso (kg)" required>
    <input type="text" name="tipo_animal" placeholder="Tipo (cachorro, gato...)" required>
    <div class="form-buttons">
      <button type="submit" class="btn btn-primary">Salvar</button>
      <button type="button" class="btn btn-secondary" onclick="cancelarEdicao()">Cancelar</button>
    </div>
  </form>


  <form action="/servicos-cliente" method="get">
    <button class="btn-fixed btn-servicos" type="submit">Serviços</button>
  </form>

  <form action="/logout" method="get">
    <button class="btn-fixed btn-sair" type="submit">Sair</button>
  </form>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script>
    function carregarPets() {
      fetch('/api/pets')
        .then(res => res.json())
        .then(pets => {
          const container = document.getElementById('lista-pets');
          container.innerHTML = '';

          if (pets.length === 0) {
            container.innerHTML = "<p>Você ainda não cadastrou nenhum pet.</p>";
            return;
          }

          pets.forEach(pet => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
              <strong>Nome:</strong> ${pet.nome}<br>
              <strong>Raça:</strong> ${pet.raca}<br>
              <strong>Idade:</strong> ${pet.idade} anos<br>
              <strong>Peso:</strong> ${pet.peso} kg<br>
              <strong>Tipo:</strong> ${pet.tipo_animal}<br>
              <button onclick='editarPet(${JSON.stringify(pet)})'>Editar</button>
              <button onclick='excluirPet(${pet.id_pet})'>Excluir</button>
            `;
            container.appendChild(card);
          });
        });
    }

    function editarPet(pet) {
      document.getElementById('form-title').innerText = "Editar Pet";
      document.getElementById('id_pet').value = pet.id_pet;
      document.querySelector('[name="nome"]').value = pet.nome;
      document.querySelector('[name="raca"]').value = pet.raca;
      document.querySelector('[name="idade"]').value = pet.idade;
      document.querySelector('[name="peso"]').value = pet.peso;
      document.querySelector('[name="tipo_animal"]').value = pet.tipo_animal;
    }

    function cancelarEdicao() {
      document.getElementById('form-title').innerText = "Cadastrar Novo Pet";
      document.getElementById('form-pet').reset();
      document.getElementById('id_pet').value = '';
    }

    async function excluirPet(id) {
      const confirmacao = await Swal.fire({
        title: 'Tem certeza?',
        text: 'Você deseja mesmo excluir este pet? Esta ação não poderá ser desfeita.',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Sim, excluir',
        cancelButtonText: 'Cancelar'
      });

      if (!confirmacao.isConfirmed) return;

      const formData = new FormData();
      formData.append('id_pet', id);

      const res = await fetch('/excluir-pet', {
        method: 'POST',
        body: formData
      });

      if (res.ok) {
        await Swal.fire({
          icon: 'success',
          title: 'Excluído!',
          text: 'O pet foi excluído com sucesso.',
          timer: 2000,
          showConfirmButton: false
        });
        carregarPets();
      } else {
        Swal.fire({
          icon: 'error',
          title: 'Erro',
          text: 'Ocorreu um erro ao excluir o pet.'
        });
      }
    }

    document.getElementById('form-pet').addEventListener('submit', async function (e) {
      e.preventDefault();
      const formData = new FormData(this);
      const rota = formData.get('id_pet') ? '/editar-pet' : '/cadastro-pet';

      try {
        const res = await fetch(rota, {
          method: 'POST',
          body: formData
        });

        if (res.ok) {
          const mensagem = formData.get('id_pet') ? 'Pet atualizado com sucesso!' : 'Novo pet cadastrado com sucesso!';
          await Swal.fire({
            icon: 'success',
            title: 'Sucesso!',
            text: mensagem,
            timer: 2000,
            showConfirmButton: false
          });
          cancelarEdicao();
          carregarPets();
        } else {
          Swal.fire({
            icon: 'error',
            title: 'Erro',
            text: 'Ocorreu um erro ao salvar os dados do pet.'
          });
        }
      } catch (err) {
        Swal.fire({
          icon: 'error',
          title: 'Erro inesperado',
          text: err.message
        });
      }
    });


    carregarPets();
  </script>
</body>

</html>
